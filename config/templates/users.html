{% extends 'base/base.html' %}

{% block content %}
    <div class="main-content">
        <!-- Header -->
        <div class="main-header">
            <div class="d-flex align-items-center">
                <button class="btn btn-outline-secondary me-3 d-lg-none" id="mobileToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <button class="btn btn-outline-secondary me-3 d-none d-lg-inline-block" id="sidebarToggle">
                    <i class="fas fa-chevron-left"></i>
                </button>
                
                <div class="page-title">
                    <h1>Gestion des utilisateurs</h1>
                    <p>Administrez les comptes administrateurs et enseignants</p>
                </div>
            </div>
            
            <div class="header-actions">
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addUserModal">
                    <i class="fas fa-user-plus me-2"></i>Ajouter un utilisateur
                </button>
            </div>
        </div>
        
        <!-- Notifications container -->
        <div id="notification-container"></div>
        
        <!-- Statistiques des utilisateurs -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card stat-card">
                    <div class="stat-icon primary">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-number">18</div>
                    <div class="stat-label">Utilisateurs totaux</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stat-card">
                    <div class="stat-icon warning">
                        <i class="fas fa-user-shield"></i>
                    </div>
                    <div class="stat-number">3</div>
                    <div class="stat-label">Administrateurs</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stat-card">
                    <div class="stat-icon success">
                        <i class="fas fa-chalkboard-teacher"></i>
                    </div>
                    <div class="stat-number">15</div>
                    <div class="stat-label">Enseignants</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stat-card">
                    <div class="stat-icon danger">
                        <i class="fas fa-user-slash"></i>
                    </div>
                    <div class="stat-number">2</div>
                    <div class="stat-label">Comptes inactifs</div>
                </div>
            </div>
        </div>
        
        <!-- Filtres et recherche -->
        <div class="card mb-4">
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-4">
                        <input type="text" class="form-control" id="searchUsers" placeholder="Rechercher un utilisateur...">
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" id="filterRole">
                            <option value="">Tous les rôles</option>
                            <option value="admin">Administrateur</option>
                            <option value="teacher">Enseignant</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" id="filterStatus">
                            <option value="">Tous les statuts</option>
                            <option value="active">Actif</option>
                            <option value="inactive">Inactif</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <button class="btn btn-outline-secondary w-100" id="resetFilters">
                            <i class="fas fa-redo"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tableau des utilisateurs -->
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">Liste des utilisateurs</h5>
                <div class="d-flex align-items-center">
                    <div class="me-3">
                        <span class="text-muted">18 utilisateurs</span>
                    </div>
                    <div class="dropdown">
                        <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <i class="fas fa-download me-1"></i> Exporter
                        </button>
                        <div class="dropdown-menu dropdown-menu-end">
                            <a class="dropdown-item" href="#"><i class="fas fa-file-excel me-2"></i>Excel</a>
                            <a class="dropdown-item" href="#"><i class="fas fa-file-csv me-2"></i>CSV</a>
                            <a class="dropdown-item" href="#"><i class="fas fa-file-pdf me-2"></i>PDF</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="table-container">
                    <table class="table table-hover mb-0" id="usersTable">
                        <thead>
                            <tr>
                                <th>Utilisateur</th>
                                <th>Email</th>
                                <th>Rôle</th>
                                <th>Téléphone</th>
                                <th>Dernière connexion</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Données chargées dynamiquement -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card-footer">
                <nav aria-label="Navigation des utilisateurs">
                    <ul class="pagination justify-content-center mb-0">
                        <li class="page-item disabled">
                            <a class="page-link" href="#" tabindex="-1">Précédent</a>
                        </li>
                        <li class="page-item active"><a class="page-link" href="#">1</a></li>
                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                        <li class="page-item">
                            <a class="page-link" href="#">Suivant</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>

    <!-- Modal d'ajout d'utilisateur -->
    <div class="modal fade" id="addUserModal" tabindex="-1" aria-labelledby="addUserModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addUserModalLabel">Ajouter un nouvel utilisateur</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="userForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="userFirstName" class="form-label">Prénom *</label>
                                <input type="text" class="form-control" id="userFirstName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="userLastName" class="form-label">Nom *</label>
                                <input type="text" class="form-control" id="userLastName" required>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="userEmail" class="form-label">Email *</label>
                                <input type="email" class="form-control" id="userEmail" required>
                                <div class="form-text">Cet email servira pour la connexion</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="userPhone" class="form-label">Téléphone</label>
                                <input type="tel" class="form-control" id="userPhone">
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="userRole" class="form-label">Rôle *</label>
                                <select class="form-select" id="userRole" required>
                                    <option value="">Sélectionner un rôle</option>
                                    <option value="admin">Administrateur</option>
                                    <option value="teacher">Enseignant</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="userDepartment" class="form-label">Département</label>
                                <select class="form-select" id="userDepartment">
                                    <option value="">Sélectionner un département</option>
                                    <option value="informatique">Informatique</option>
                                    <option value="mathematiques">Mathématiques</option>
                                    <option value="physique">Physique</option>
                                    <option value="autres">Autres</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="userPassword" class="form-label">Mot de passe *</label>
                                <div class="input-group">
                                    <input type="password" class="form-control" id="userPassword" required>
                                    <button class="btn btn-outline-secondary" type="button" id="toggleUserPassword">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                                <div class="form-text">Minimum 8 caractères avec chiffres et lettres</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="userConfirmPassword" class="form-label">Confirmer le mot de passe *</label>
                                <div class="input-group">
                                    <input type="password" class="form-control" id="userConfirmPassword" required>
                                    <button class="btn btn-outline-secondary" type="button" id="toggleConfirmPassword">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="sendWelcomeEmail" checked>
                                <label class="form-check-label" for="sendWelcomeEmail">
                                    Envoyer un email de bienvenue avec les identifiants
                                </label>
                            </div>
                        </div>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            L'utilisateur recevra un email avec ses identifiants de connexion.
                            Il devra changer son mot de passe lors de sa première connexion.
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <button type="submit" form="userForm" class="btn btn-primary">Créer l'utilisateur</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de modification d'utilisateur -->
    <div class="modal fade" id="editUserModal" tabindex="-1" aria-labelledby="editUserModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editUserModalLabel">Modifier l'utilisateur</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editUserForm">
                        <input type="hidden" id="editUserId">
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="editFirstName" class="form-label">Prénom *</label>
                                <input type="text" class="form-control" id="editFirstName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="editLastName" class="form-label">Nom *</label>
                                <input type="text" class="form-control" id="editLastName" required>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="editEmail" class="form-label">Email *</label>
                                <input type="email" class="form-control" id="editEmail" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="editPhone" class="form-label">Téléphone</label>
                                <input type="tel" class="form-control" id="editPhone">
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="editRole" class="form-label">Rôle *</label>
                                <select class="form-select" id="editRole" required>
                                    <option value="admin">Administrateur</option>
                                    <option value="teacher">Enseignant</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="editDepartment" class="form-label">Département</label>
                                <select class="form-select" id="editDepartment">
                                    <option value="">Sélectionner un département</option>
                                    <option value="informatique">Informatique</option>
                                    <option value="mathematiques">Mathématiques</option>
                                    <option value="physique">Physique</option>
                                    <option value="autres">Autres</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="editIsActive" checked>
                                <label class="form-check-label" for="editIsActive">
                                    Compte actif
                                </label>
                            </div>
                        </div>
                        
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            La modification du rôle peut affecter les permissions de l'utilisateur.
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <button type="submit" form="editUserForm" class="btn btn-primary">Enregistrer les modifications</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de réinitialisation de mot de passe -->
    <div class="modal fade" id="resetPasswordModal" tabindex="-1" aria-labelledby="resetPasswordModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="resetPasswordModalLabel">Réinitialiser le mot de passe</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="resetPasswordForm">
                        <input type="hidden" id="resetUserId">
                        
                        <div class="mb-3">
                            <p>Vous êtes sur le point de réinitialiser le mot de passe de <strong id="resetUserName"></strong>.</p>
                            <p>L'utilisateur recevra un email avec un lien pour créer un nouveau mot de passe.</p>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="forcePasswordChange" checked>
                                <label class="form-check-label" for="forcePasswordChange">
                                    Forcer le changement de mot de passe à la prochaine connexion
                                </label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <button type="submit" form="resetPasswordForm" class="btn btn-warning">Réinitialiser le mot de passe</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de confirmation de suppression -->
    <div class="modal fade" id="deleteUserModal" tabindex="-1" aria-labelledby="deleteUserModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteUserModalLabel">Confirmer la suppression</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Attention !</strong> Cette action est irréversible.
                    </div>
                    <p>Êtes-vous sûr de vouloir supprimer l'utilisateur <strong id="deleteUserName"></strong> ?</p>
                    <p>Toutes les données associées à cet utilisateur seront affectées :</p>
                    <ul>
                        <li>Les cours dont il est responsable seront réassignés</li>
                        <li>L'historique des présences sera conservé</li>
                        <li>L'utilisateur ne pourra plus se connecter</li>
                    </ul>
                    
                    <div class="mb-3">
                        <label for="reassignTo" class="form-label">Réassigner les cours à :</label>
                        <select class="form-select" id="reassignTo">
                            <option value="">-- Sélectionner un enseignant --</option>
                            <!-- Options chargées dynamiquement -->
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="confirmDeleteText" class="form-label">
                            Tapez "SUPPRIMER" pour confirmer
                        </label>
                        <input type="text" class="form-control" id="confirmDeleteText" 
                               placeholder="SUPPRIMER">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteUserBtn" disabled>
                        Supprimer définitivement
                    </button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/main.js"></script>
    <script src="js/users.js"></script>
</body>
</html>